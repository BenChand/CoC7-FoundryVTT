<div class="coc7 chat-card chat-card-v2">
  <form class="flexcol">
    <header class="card-header">
      <div class="left-portrait">
        {{#if displayActorOnCard}}
					<img class="open-actor {{card.participant.cssClass}}" data-actor-key="{{card.participant.key}}" src="{{card.participant.icon}}" title="{{card.participant.name}}" width="36" height="36"/>
        {{/if}}
      </div>
      {{#if data.states.obstacleDefined}}
      <div class="card-title">{{#if data.obstacle.name}}{{data.obstacle.name}}{{else}}{{ localize 'CoC7.Obstacle'}}{{/if}}</div>
      <div class="right-portrait">
          {{#if data.obstacle.barrier}}
            <img src="systems/CoC7/assets/icons/barrier.svg">
          {{else}}
            <img src="systems/CoC7/assets/icons/hazard-sign.svg">
          {{/if}}
      </div>
      {{/if}}
    </header>

		<datalist id="check-options">
      
      {{#each checkOptions as |o|}}
        <option>{{o}}</option>
      {{/each}}
    </datalist>

    <div class="player-actions">
      <div class='info'>
        {{#if data.states.obstacleDefined}}
          <div>{{strings.obstacleDefined}}</div>
          {{#if data.states.checkDefined}}
            <div>**** playerIntentions {{ strings.playerIntentions }} ****</div>
            {{#unless dummyActor}}
              {{#if data.states.checkRolled}}
                <div>**** checkRolled {{ strings.checkRolled}} **** {{data.card.roll.value.value.name}} : {{{ htmlCheck }}}</div>
                {{#if data.objects.check.passed}}
                  <div>**** obstaclePassed {{ strings.obstaclePassed }} ****</div>
                {{else}}
                  <div>**** checkFailled {{ strings.checkFailled }} ****</div>
                  {{#if data.states.cardResolved}}
                    {{#if damageTaken}}
                      <div>**** damageTaken {{ strings.damageTaken}} **** : {{{inlineDamageTakenRoll}}}</div>
                    {{/if}}
                    {{#if actionLost}}
                      <div>**** actionLost {{ strings.actionLost }} **** : {{{inlineActionLostRoll}}}</div>
                    {{/if}}
                  {{/if}}
                {{/if}}
              {{else}}
                <div class="card-buttons">
                  <button class='submit' data-ecc-visibility="{{card.participant.actor.uuid}}" data-action='rollSkillCheck'>{{ strings.rollRequest }}</button>
                </div>
              {{/if}}
            {{/unless}}
          {{else}}
            <div>{{ localize 'CoC7.AskIntentions' }}</div>
          {{/if}}
        {{else}}
          <div>{{ localize 'CoC7.SomethingInTheWay' }}</div>
        {{/if}}
      </div>
    </div>

    <div data-ecc-visibility="gm" class="gm-actions">
      {{#if data.states.obstacleDefined}}
        {{#if data.states.actionDefined}}
          {{#if data.states.tryToPass}}
            {{#if data.states.rolled}}
            {{else}}
              {{#if data.states.waitForRoll}}
                {{#if data.states.checkRolled}}
                  {{#if data.objects.check.passed}}
                    Check passed
                  {{else}}
                    Check failled
                    {{#if data.states.cardResolved}}
                    {{else}}
                      {{#if data.obstacle.barrier}}
                        Barier failled
                        <div class="form-group small">
                          <div class="flexrow flex1">
                          </div>
                          <div class="flexrow flex1">
                            <a data-ecc-permissions="gm" data-name="data.obstacle.hasDamage" class="toggle-icon ecc-switch">
                              <i class="game-icon game-icon-broken-bone"></i>
                            </a>
                            {{#if data.obstacle.hasDamage }}
                              <input type="text" data-ecc-permissions="gm" name="data.obstacle.failedCheckDamage" value="{{data.obstacle.failedCheckDamage}}">
                            {{/if}}
                          </div>
                        </div>
                        <div class="card-buttons">
                          {{#if validFailledRolls}}
                          <button class="submit" data-action="rollFailConsequences">Validate</button>
                          {{/if}}
                        </div>
                      {{/if}}
                      {{#if data.obstacle.hazard}}
                        Hazard failled
                        {{#if data.states.obstacleFailledResolved}}
                        {{else}}
                          <div class="form-group small">
                            <div class="flexrow flex1">
                              <a data-ecc-permissions="gm" data-name="data.obstacle.hasActionCost" class="toggle-icon ecc-switch">
                                <i class="fas fa-bahai"></i>
                              </a>
                              {{#if data.obstacle.hasActionCost }}
                                <input type="text" data-ecc-permissions="gm" name="data.obstacle.failedActionCost" value="{{data.obstacle.failedActionCost}}">
                              {{/if}}
                            </div>
                            <div class="flexrow flex1">
                              <a data-ecc-permissions="gm" data-name="data.obstacle.hasDamage" class="toggle-icon ecc-switch">
                                <i class="game-icon game-icon-broken-bone"></i>
                              </a>
                              {{#if data.obstacle.hasDamage }}
                                <input type="text" data-ecc-permissions="gm" name="data.obstacle.failedCheckDamage" value="{{data.obstacle.failedCheckDamage}}">
                              {{/if}}
                            </div>
                          </div>
                          <div class="card-buttons">
                            {{#if validFailledRolls}}
                            <button class="submit" data-action="rollFailConsequences">Validate</button>
                            {{/if}}
                          </div>
                        {{/if}}
                      {{/if}}
                    {{/if}}
                  {{/if}}
                {{else}}
                <span>Waiting for roll</span>
                {{/if}}
              {{else}}
                <div class="form-group">
                  {{#if card.participant.hasBonusDice}}
                  <div data-flag="consumeBonusDice" class="toggle-switch ecc-switch">Consume bonus dice</div>
                  {{/if}}
                </div>
                <div class="form-group">
                  <input type="range" data-ecc-permissions="gm" name="data.card.bonusDice" min="-2" max="2" value="{{data.card.bonusDice}}" class="slider">
                </div>
                <div class="form-group">
                  <input type="text" class="flex4" data-ecc-permissions="gm" name="data.obstacle.checkName" value="{{data.obstacle.checkName}}"
                    list='check-options' placeholder="{{ localize 'CoC7.Skill' }}"/>
                  {{#if validSkill}}
                    : {{skill.value.value}}%
                  {{else}}
                    : <input type="text" data-ecc-permissions="gm" name="data.card.checkThreshold" value="{{data.card.checkThreshold}}"
                      placeholder="{{ localize 'CoC7.Value'}}" title="{{strings.EnterValueTitle}}"/>
                  {{/if}}
                </div>
                <div class="card-buttons">
                  {{#if validCheck}}
                  <button class="submit" data-action="requestRoll">Request roll</button>
                  {{/if}}
                </div>
              {{/if}}
            {{/if}}
          {{else}}
            <div class="form-group">
              <label>{{ localize 'CoC7.HitPoints' }}: </label>
              <input type="text" data-ecc-permissions="gm" name="data.obstacle.HitPoints" value="{{data.obstacle.HitPoints}}">
            </div>
          {{/if}}
        {{else}}
          <div>{{ localize 'CoC7.AskPlayerAction' }}</div>
          <div class="card-buttons">
            <button class='submit' data-action='tryToPassObstacle'>Attempt to pass that obstacle</button>
            <button class='submit' data-action='tryToreakThroughObstacle'>Attempt to break through !!</button>
          </div>
        {{/if}}
      {{else}}
      <div class="form-group ecc-radio">
        <div data-name="data.obstacle.barrier" class="toggle-switch ecc-switch">barrier</div>
        <div data-name="data.obstacle.hazard" class="toggle-switch ecc-switch">hazard</div>
      </div>
      {{#if data.obstacle.barrier}}
      <div class="form-group">
        <div data-name="data.obstacle.hasHitPoints" class="toggle-switch ecc-switch">Can be broken</div>
      </div>
      {{/if}}
      <div class="form-group">
        <label>Obstacle name:</label>
        <input type="text" data-ecc-permissions="gm" name="data.obstacle.name" value="{{data.obstacle.name}}"/>
      </div>
      <div class="card-buttons">
        <button class='submit' data-action='defineObstacle'>Validate</button>
      </div>
      {{/if}}

      <div class="status-list">
        <div class="status movement-action">
            actions :
            {{#each card.participant.movementActionArray as |actionClass|}}
            <i class="fas fa-bahai {{actionClass}}"></i>
            {{/each}}
        </div>
        {{#each status as |s|}}
        <div class="status {{s.css}}">{{s.name}}</div>
        {{/each}}
      </div>
    </div>
  </form>
</div>